# PoetryMatch: å¤å…¸è¯—æ­ŒåŒ¹é…ç³»ç»Ÿ

## ðŸ“– é¡¹ç›®ç®€ä»‹

**PoetryMatch** æ˜¯ä¸€ä¸ªè‡ªç„¶è¯­è¨€å¤„ç† (NLP) é¡¹ç›®ï¼Œæ—¨åœ¨å°†çŽ°ä»£æ–‡æè¿°ä¸Žå…¶å¯¹åº”çš„ä¸­å›½å¤å…¸è¯—å¥è¿›è¡ŒåŒ¹é…ã€‚è¯¥ä»»åŠ¡æŒ‘æˆ˜æ¨¡åž‹ç†è§£çŽ°ä»£æ±‰è¯­å’Œå¤å…¸æ±‰è¯­è¯­ä¹‰çš„èƒ½åŠ›ï¼Œå¹¶è¦æ±‚æ¨¡åž‹èƒ½å¤Ÿä»Žå€™é€‰é¡¹ä¸­è¯†åˆ«å‡ºä¸Žç»™å®šçŽ°ä»£æ–‡è¯­å¢ƒæœ€åŒ¹é…çš„è¯—å¥ã€‚

ç»™å®šä¸€æ®µçŽ°ä»£æ–‡æè¿°å’Œå››å¥å€™é€‰å¤è¯—ï¼Œç³»ç»Ÿéœ€è¦è¯†åˆ«å‡ºæœ€ç¬¦åˆæè¿°çš„é‚£ä¸€å¥ã€‚

ç¤ºä¾‹ï¼š
> **æè¿°**: ä¸€ç”Ÿå½“ä¸­ç–¾ç—…ç¼ èº«ä»Šæ—¥ç‹¬ä¸Šé«˜å°ã€‚
>
> **å€™é€‰é¡¹**:
> 1. ä¸€æ˜¥å¤šç—…å‡ ç™»å°
> 2. **ç™¾å¹´å¤šç—…ç‹¬ç™»å°** (æ­£ç¡®ç­”æ¡ˆ)
> 3. ç™¾å¹´å¤šç—…è´Ÿç™»ä¸´
> 4. å†µå¤šæ„ç—…ç‹¬ç™»å°

## ðŸ“‚ é¡¹ç›®ç»“æž„

```
PoetryMatch/
â”œâ”€â”€ chinese-roberta-wwm-ext/ # æœ¬åœ° RoBERTa æ¨¡åž‹æƒé‡
â”œâ”€â”€ guwenbert-base/          # æœ¬åœ° GuwenBERT æ¨¡åž‹æƒé‡ 
â”œâ”€â”€ datasets/                # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ train.jsonl          # è®­ç»ƒé›† (7000 æ¡)
â”‚   â”œâ”€â”€ val.jsonl            # éªŒè¯é›†
â”‚   â””â”€â”€ test.jsonl           # æµ‹è¯•é›† (1000 æ¡)
â”œâ”€â”€ models/                  # æ¨¡åž‹ä¿å­˜è·¯å¾„ (saved_best/)
â”œâ”€â”€ src/                     # æºä»£ç 
â”‚   â”œâ”€â”€ config.py            # é…ç½®å‚æ•°
â”‚   â”œâ”€â”€ dataset.py           # æ•°æ®åŠ è½½ä¸Žå¤„ç†
â”‚   â”œâ”€â”€ evaluate.py          # è¯„ä¼°è„šæœ¬
â”‚   â”œâ”€â”€ model.py             # æ¨¡åž‹å®šä¹‰
â”‚   â”œâ”€â”€ train.py             # è®­ç»ƒè„šæœ¬
â”‚   â””â”€â”€ utils.py             # å·¥å…·å‡½æ•°
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”œâ”€â”€ README.md                # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ .gitignore               # Git å¿½ç•¥æ–‡ä»¶
```

## ðŸ§  æŠ€æœ¯ç»†èŠ‚

### æ•°æ®é¢„å¤„ç† (Data Preprocessing)

æ¨¡åž‹æŽ¥å—çš„è¾“å…¥å½¢å¼ä¸º **"çŽ°ä»£æ–‡æè¿° + å€™é€‰è¯—å¥"** çš„æ‹¼æŽ¥å¯¹ã€‚å¯¹äºŽæ¯ä¸ªæ ·æœ¬ï¼ˆ1 ä¸ªæè¿° + 4 ä¸ªé€‰é¡¹ï¼‰ï¼Œæˆ‘ä»¬æž„é€  4 ä¸ªç‹¬ç«‹çš„è¾“å…¥åºåˆ—ä¾›æ¨¡åž‹æ‰“åˆ†ï¼š

æ ¼å¼ï¼š`[CLS] çŽ°ä»£æ–‡æè¿° [SEP] å€™é€‰è¯—å¥_i [SEP]`

ä¾‹å¦‚ï¼š
1. `[CLS] æè¿°æ–‡æœ¬ [SEP] é€‰é¡¹1 [SEP]`
2. `[CLS] æè¿°æ–‡æœ¬ [SEP] é€‰é¡¹2 [SEP]`
...

è¿™äº›è¾“å…¥ç»è¿‡ Tokenizer å¤„ç†ï¼ˆPadding/Truncationï¼‰åŽï¼Œç»Ÿä¸€ä¸ºé•¿åº¦ `max_len` (é»˜è®¤ 128) çš„å¼ é‡ã€‚

### æ¨¡åž‹æž¶æž„ (Model Architecture)

æœ¬é¡¹ç›®ä½¿ç”¨ **BertForMultipleChoice** æž¶æž„ï¼š
1. **å…±äº«ç¼–ç å™¨**: 4 ä¸ªè¾“å…¥åºåˆ—å…±äº«åŒä¸€ä¸ª BERT æ¨¡åž‹å‚æ•°ã€‚
2. **ç‰¹å¾æå–**: å–æ¯ä¸ªåºåˆ— `[CLS]` ä½ç½®çš„è¾“å‡ºå‘é‡ã€‚
3. **è¯„åˆ†å±‚**: é€šè¿‡ä¸€ä¸ªçº¿æ€§å±‚ï¼ˆDropout + Linearï¼‰å°† `[CLS]` å‘é‡æ˜ å°„ä¸ºä¸€ä¸ªæ ‡é‡åˆ†æ•°ã€‚
4. **é¢„æµ‹**: å¯¹ 4 ä¸ªé€‰é¡¹çš„åˆ†æ•°è¿›è¡Œ Softmax å½’ä¸€åŒ–ï¼Œæ¦‚çŽ‡æœ€å¤§çš„å³ä¸ºé¢„æµ‹ç»“æžœã€‚

æ¨¡åž‹ä¸‹è½½ï¼š

1. [chinese-roberta-wwm-ext](https://pan.quark.cn/s/308b5a5652c5?pwd=D6r4)
2. [guwenbert-base](https://pan.quark.cn/s/522c7e6a16ac?pwd=s8zP)
3. [my_best_model](https://pan.quark.cn/s/02a63251b676?pwd=PxUK)

## ðŸš€ å¿«é€Ÿå¼€å§‹

### å‡†å¤‡å·¥ä½œ

- Python 3.10
- æ”¯æŒ CUDA çš„ GPU (å»ºè®®ç”¨äºŽè®­ç»ƒ)

### å®‰è£…

1. å…‹éš†ä»“åº“ï¼š
   ```bash
   git clone https://github.com/yourusername/PoetryMatch.git
   cd PoetryMatch
   ```

2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```

### æ•°æ®é›†å‡†å¤‡

ç¡®ä¿æ‚¨çš„æ•°æ®é›†æ–‡ä»¶ (`train.jsonl`, `val.jsonl`, `test.jsonl`) ä½äºŽ `datasets/` ç›®å½•ä¸‹ã€‚JSONL æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½åº”æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ JSON å¯¹è±¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "id": 5253, 
  "translation": "è‡ªè¯´æ˜¯æ–°è¿‘é‡Œç«‹åŠŸå°å®˜ã€‚", 
  "choices": ["æ–°å°ä¸‡æˆ·ä¾¯", "ä¸­é“æ••å°ä¾¯", "æ–°å°åƒæˆ·ä¾¯", "è‡ªé“æ–°å°ä¾¯"], 
  "answer": 3
}
```

## ðŸ› ï¸ ä½¿ç”¨æŒ‡å—

### è®­ç»ƒ

è¿è¡Œ `train.py` è„šæœ¬ä»¥è®­ç»ƒæ¨¡åž‹ã€‚æ‚¨å¯ä»¥åœ¨ `src/config.py` ä¸­è°ƒæ•´è¶…å‚æ•°ã€‚

```bash
python src/train.py
```

è¯¥è„šæœ¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
- åŠ è½½é¢„è®­ç»ƒæ¨¡åž‹ (é»˜è®¤: `bert-base-chinese`ï¼Œå¯é…ç½®ä¸ºæœ¬åœ°è·¯å¾„)ã€‚
- åœ¨è®­ç»ƒé›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚
- æ¯ä¸ª epoch ç»“æŸåŽåœ¨éªŒè¯é›†ä¸Šè¿›è¡ŒéªŒè¯ã€‚
- å°†éªŒè¯é›†å‡†ç¡®çŽ‡æœ€é«˜çš„æ¨¡åž‹ä¿å­˜åˆ° `models/saved_best/`ã€‚

### è¯„ä¼°

è¦åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡åž‹ï¼Œè¯·è¿è¡Œï¼š

```bash
python src/evaluate.py
```

è¿™å°†åŠ è½½ `models/saved_best/` ä¸­çš„æœ€ä½³æ¨¡åž‹ï¼Œå¹¶åœ¨æµ‹è¯•é›†ä¸Šè¾“å‡ºå‡†ç¡®çŽ‡ã€‚

## ðŸ“Š è¯„ä»·æŒ‡æ ‡

æ¨¡åž‹ä½¿ç”¨ **å‡†ç¡®çŽ‡ (Accuracy)** è¿›è¡Œè¯„ä¼°ï¼š

$$
Acc = \frac{1}{N} \sum_{i=1}^N \mathbb{I}(x_i = y_i)
$$

å…¶ä¸­ $N$ æ˜¯æ ·æœ¬æ€»æ•°ï¼Œ$x_i$ æ˜¯é¢„æµ‹ç±»åˆ«ï¼Œ$y_i$ æ˜¯çœŸå®žæ ‡ç­¾ã€‚

## ðŸ¤– æ¨¡åž‹æ”¯æŒ

æœ¬é¡¹ç›®æ”¯æŒåŸºäºŽ BERT çš„å„ç§é¢„è®­ç»ƒæ¨¡åž‹ã€‚æ‚¨å¯ä»¥åœ¨ `src/config.py` ä¸­ä¿®æ”¹ `model_name` æ¥æŒ‡å®šï¼š

- **HuggingFace åœ¨çº¿æ¨¡åž‹**: å¦‚ `bert-base-chinese`
- **æœ¬åœ°æ¨¡åž‹**: 
  - `./chinese-roberta-wwm-ext`: å“ˆå·¥å¤§è®¯é£žè”åˆå®žéªŒå®¤å‘å¸ƒçš„ RoBERTa-wwm-ext æ¨¡åž‹ã€‚
  - `./guwenbert-base`: ä¸“é—¨é’ˆå¯¹å¤æ–‡ï¼ˆæ–‡è¨€æ–‡ï¼‰é¢„è®­ç»ƒçš„ BERT æ¨¡åž‹ï¼ŒæŽ¨èå°è¯•ä»¥èŽ·å¾—æ›´å¥½æ•ˆæžœã€‚

## ðŸ¤ è‡´è°¢

- Hugging Face Transformers æä¾›æ¨¡åž‹æž¶æž„æ”¯æŒã€‚
- é¢„è®­ç»ƒæ¨¡åž‹ï¼š`bert-base-chinese`, `guwenbert`, `roberta-wwm-ext`ã€‚

> Note: Assistant with `Antigravity`